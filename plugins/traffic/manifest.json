{
  "id": "traffic",
  "name": "Traffic",
  "version": "1.0.0",
  "description": "Display commute times and traffic conditions using Google Routes API",
  "author": "FiestaBoard Team",
  "repository": "https://github.com/FiestaBoard/FiestaBoard",
  "documentation": "README.md",
  "icon": "car",
  "category": "transit",

  "settings_schema": {
    "type": "object",
    "properties": {
      "enabled": {
        "type": "boolean",
        "title": "Enable Traffic",
        "default": false
      },
      "api_key": {
        "type": "string",
        "title": "Google Routes API Key",
        "description": "API key with Routes API enabled",
        "ui:widget": "password"
      },
      "routes": {
        "type": "array",
        "title": "Routes",
        "description": "Commute routes to monitor (max 4)",
        "maxItems": 4,
        "items": {
          "type": "object",
          "properties": {
            "origin": {
              "type": "string",
              "title": "Origin",
              "description": "Starting address or coordinates"
            },
            "destination": {
              "type": "string",
              "title": "Destination",
              "description": "Ending address or coordinates"
            },
            "destination_name": {
              "type": "string",
              "title": "Display Name",
              "description": "Short name (e.g., WORK, HOME)",
              "maxLength": 10
            }
          },
          "required": ["origin", "destination", "destination_name"]
        }
      },
      "refresh_seconds": {
        "type": "integer",
        "title": "Refresh Interval (seconds)",
        "default": 300,
        "minimum": 60
      }
    },
    "required": ["api_key", "routes"]
  },

  "env_vars": [
    {
      "name": "GOOGLE_ROUTES_API_KEY",
      "required": true,
      "description": "Google Cloud API key with Routes API enabled"
    },
    {
      "name": "TRAFFIC_ORIGIN",
      "required": false,
      "description": "Default origin address"
    },
    {
      "name": "TRAFFIC_DESTINATION",
      "required": false,
      "description": "Default destination address"
    },
    {
      "name": "TRAFFIC_DESTINATION_NAME",
      "required": false,
      "description": "Display name for destination",
      "default": "DOWNTOWN"
    }
  ],

  "variables": {
    "simple": [
      "duration_minutes",
      "delay_minutes",
      "traffic_status",
      "traffic_color",
      "destination_name",
      "formatted",
      "route_count",
      "worst_delay"
    ],
    "arrays": {
      "routes": {
        "label_field": "destination_name",
        "item_fields": [
          "duration_minutes",
          "delay_minutes",
          "traffic_status",
          "traffic_color",
          "destination_name",
          "formatted"
        ]
      }
    }
  },

  "max_lengths": {
    "duration_minutes": 3,
    "delay_minutes": 3,
    "traffic_status": 8,
    "traffic_color": 4,
    "destination_name": 10,
    "formatted": 22,
    "route_count": 1,
    "worst_delay": 3,
    "routes.*.duration_minutes": 3,
    "routes.*.delay_minutes": 3,
    "routes.*.traffic_status": 8,
    "routes.*.destination_name": 10,
    "routes.*.formatted": 22
  },

  "color_rules_schema": {
    "traffic_status": {
      "type": "match",
      "description": "Color based on traffic status",
      "default_rules": [
        {"condition": "==", "value": "LIGHT", "color": "green"},
        {"condition": "==", "value": "MODERATE", "color": "yellow"},
        {"condition": "==", "value": "HEAVY", "color": "red"}
      ]
    }
  }
}

