# Vesta Project Development Rules

## Docker-First Development

This project uses Docker containers for ALL development, testing, and debugging activities.

### Core Rules

1. **NEVER run the API server (`src/api_server.py` or `python -m src.api_server`) directly on the host machine**
   - Always use Docker containers via `docker-compose` commands

2. **NEVER run the web UI (`npm run dev` in `web/` directory) directly on the host machine**
   - Always use Docker containers via `docker-compose` commands

3. **NEVER install Python dependencies locally or suggest running `pip install`**
   - All Python dependencies are managed within Docker containers

4. **NEVER install Node.js dependencies locally or suggest running `npm install` in the web/ directory**
   - All Node.js dependencies are managed within Docker containers

### Development Workflow

- **Starting services**: Use `/start` command or `docker-compose -f docker-compose.dev.yml up`
- **Stopping services**: Use `/stop` command or `docker-compose -f docker-compose.dev.yml down`
- **Restarting**: Use `/restart` command (stops, rebuilds with --no-cache, restarts)
- **Building**: Use `/build` command to rebuild images without restarting
- **Running tests**: Use `/test-api` or `/test-web` commands to run tests inside Docker containers
- **Debugging**: Use `docker-compose logs -f` or `docker-compose exec` for interactive debugging
- **Checking status**: Use `docker-compose ps` to see which containers are running
- **Code changes**: Edit code on host machine; Docker volumes will sync changes automatically
- **Installing dependencies**: 
  - For Python: Update `requirements.txt` and rebuild containers
  - For Node.js: Update `web/package.json` and rebuild containers

### Testing Guidelines

- All tests must run inside Docker containers
- Use `docker-compose exec <service> pytest` for Python tests
- Use `docker-compose exec <service> npm test` for web tests
- Re-testing after changes should also be done in containers

### Exceptions

The only code that may run locally:
- The `macos_helper/` service (macOS-specific Apple Music integration)
- Utility scripts explicitly marked for local execution

### Available Cursor Commands

- `/setup` - Check and install prerequisites (Homebrew, Docker) and configure environment
- `/start` - Start all Docker containers
- `/stop` - Stop all Docker containers
- `/restart` - Stop, rebuild with --no-cache, and restart all containers
- `/redeploy` - Full rebuild with --no-cache and restart (alias for restart)
- `/redeploy-quick` - Quick rebuild (with cache) and restart
- `/build` - Rebuild Docker images without restarting
- `/status` - Show status of all Docker containers
- `/logs` - View Docker container logs
- `/test-api` - Run API tests in Docker
- `/test-web` - Run web tests in Docker
- `/deploy-to-nas` - Deploy to Synology NAS (builds images, transfers to NAS, starts containers)

### When Suggesting Commands

Always suggest Docker-based commands:
- ✅ Use `/start` and `/stop` Cursor commands to control containers
- ✅ Use `/restart` Cursor command for full redeployment with clean rebuild
- ✅ Use `/build` Cursor command to rebuild images
- ✅ Use `/test-api` or `/test-web` Cursor commands for testing
- ✅ `docker-compose -f docker-compose.dev.yml up`
- ✅ `docker-compose exec api pytest`
- ✅ `docker-compose exec web npm test`
- ❌ `python src/api_server.py`
- ❌ `cd web && npm run dev`
- ❌ `pip install -r requirements.txt`

## Documentation Requirements

### Feature Documentation

When adding a new feature to the project:
- **MUST update the README.md file** to document the new feature
- Include a description of what the feature does
- Document any configuration requirements or setup steps
- Update relevant sections (Features, Configuration, Usage, etc.) as appropriate
- Ensure the documentation is clear and accessible to users
- **MUST document all feature variables (API keys, configuration values, etc.) in `env.example`**
  - Add environment variable entries with clear descriptions
  - Include example values where appropriate
  - Mark optional vs required variables
  - Follow the existing format and style in `env.example`
- **MUST include a screenshot showing the feature in action**
  - Add screenshot to the `images/` directory with a descriptive filename (e.g., `feature-name-display.png`)
  - Include the screenshot in the feature's documentation file (`docs/features/FEATURE_NAME_SETUP.md`)
  - Use relative path format: `![Feature Description](../images/feature-name-display.png)`
  - Screenshot should clearly demonstrate what the feature does and how it appears on the Vestaboard

## Development Artifacts

### No Temporary Markdown Files

**NEVER leave temporary markdown files in the repository root after completing a feature or task.**

Examples of files that should NOT be committed or left behind:
- ❌ Implementation notes (e.g., `FEATURE_IMPLEMENTATION.md`, `BAYWHEELS_UI_UPDATE.md`)
- ❌ Testing notes (e.g., `MANUAL_TESTING_*.md`, `TESTING_*.md`)
- ❌ Review summaries (e.g., `REVIEW_SUMMARY.md`, `IMPLEMENTATION_SUMMARY.md`)
- ❌ Edge case documentation (e.g., `EDGE_CASES.md`, `STATE_TRACKING.md`)
- ❌ Performance test notes (e.g., `PERFORMANCE_TEST.md`)
- ❌ Fix documentation (e.g., `DOCKER_PUBLISHING_FIX.md`)

### Proper Documentation Locations

Instead, put documentation in the appropriate place:

**For permanent documentation:**
- **Features**: `docs/features/FEATURE_NAME_SETUP.md` - User-facing setup guides
- **Deployment**: `docs/deployment/*.md` - Deployment and infrastructure docs
- **Reference**: `docs/reference/*.md` - Technical reference material
- **Setup**: `docs/setup/*.md` - Development environment setup
- **Architecture**: Add to `README.md` or create `docs/reference/ARCHITECTURE.md`
- **Web UI features**: `web/src/components/README.md` or component-specific docs in `web/`

**For temporary notes during development:**
- Keep notes in your local environment (not in git)
- Use comments in code for implementation details
- Use PR descriptions for change summaries
- Delete any temporary `.md` files before committing

### Cleanup Rule

Before completing any feature or task:
1. Review the repository root for any `*.md` files that aren't `README.md`
2. Move any valuable information to the proper location in `docs/`
3. Delete all temporary implementation/testing markdown files
4. Ensure all critical information is preserved in proper documentation

